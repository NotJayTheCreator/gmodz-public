ZombieSpawns = {}
ZombieSpawns["rp_stalker_new"] = {Vector(-10363, -10495, -629), Vector(-10518, -9805, -680), Vector(-10518, -9805, -680), Vector(-11144, -10530, -640), Vector(-11144, -10530, -640), Vector(-12073, -10825, -640), Vector(-12073, -10825, -640), Vector(-12054, -10624, -638), Vector(-12033, -10370, -640), Vector(-12033, -10370, -640), Vector(-12452, -10909, -640), Vector(-11654, -11360, -576), Vector(-11090, -11103, -640), Vector(-11090, -11103, -640), Vector(-10947, -11980, -640), Vector(-11460, -12021, -576), Vector(-11460, -12021, -576), Vector(-11606, -11776, -576), Vector(-11494, -11630, -576), Vector(-11926, -11561, -576), Vector(-11890, -11742, -448), Vector(-11034, -12014, -640), Vector(-11050, -12573, -627), Vector(-10160, -12135, -610), Vector(10458, 12831, -387), Vector(10335, 12993, -383), Vector(10335, 12993, -383), Vector(10567, 12961, -388), Vector(10567, 12961, -388), Vector(10532, 13154, -384), Vector(10532, 13154, -384), Vector(10814, 13111, -392), Vector(10808, 12816, -391), Vector(10995, 12760, -394), Vector(11093, 13173, -384), Vector(11093, 13173, -384), Vector(10543, 13500, -384), Vector(10791, 13533, -392), Vector(10849, 13883, -392), Vector(10849, 13883, -392), Vector(10672, 13884, -392), Vector(10672, 13884, -392), Vector(10349, 13987, -384), Vector(10353, 13837, -384), Vector(11053, 13821, -403), Vector(11053, 13821, -403), Vector(-4619, 11979, 19), Vector(-4527, 12099, 26), Vector(-4463, 11953, 30), Vector(-319, 5119, -448), Vector(-319, 5119, -448), Vector(-313, 5285, -448), Vector(-67, 5169, -448), Vector(839, 5758, -256), Vector(729, 6230, -256), Vector(1415, 6340, -256), Vector(1539, 6657, -256), Vector(1539, 6657, -256), Vector(1737, 5860, -256), Vector(1790, 5579, -256), Vector(1219, 5516, -256), Vector(809, 5339, -256), Vector(615, 5066, -320), Vector(158, 4724, -448), Vector(158, 4724, -448), Vector(-849, 2885, -125), Vector(-852, 2751, -125), Vector(-852, 2751, -125), Vector(-1182, 1870, -86), Vector(-1182, 2184, -90), Vector(-1354, 2246, -92), Vector(-1196, 2383, -87), Vector(-710, 2027, -128), Vector(-935, 1876, -96), Vector(-564, 2196, -128), Vector(-511, 2579, -128), Vector(-470, 2442, -128), Vector(-381, 2126, -128), Vector(-356, 1470, -128), Vector(127, 1614, -128), Vector(331, 2028, -128), Vector(658, 2036, -128), Vector(952, 1830, -99), Vector(-795, -977, 6), Vector(-763, -601, 0), Vector(-590, -278, 0), Vector(-1152, -533, -5), Vector(-1183, -375, -8), Vector(-1819, -2511, -8), Vector(-1926, -2753, 0), Vector(-1789, -2928, -8), Vector(-959, -4369, -4), Vector(-959, -4369, -4), Vector(-1209, -4885, -8), Vector(-1237, -4344, -8), Vector(-1932, -4601, -4), Vector(-1831, -4909, -8), Vector(-1832, -4020, -8), Vector(-1474, -4051, -4), Vector(-1268, -3972, -8), Vector(-1780, -3675, -8), Vector(-2383, -3802, -4), Vector(-2036, -3506, -4), Vector(-1747, -3428, -8), Vector(-1914, -4183, -8), Vector(-1232, -4050, -8), Vector(-1230, -4626, -8), Vector(-1320, -3065, -8), Vector(-900, -3389, -8), Vector(-820, -3713, -8), Vector(-218, -3879, -8), Vector(-218, -3879, -8), Vector(-513, -4566, 32), Vector(-618, -4847, 32), Vector(-552, -4113, 32), Vector(-1493, -6208, 32), Vector(-1626, -6188, 32), Vector(-1496, -5812, -39), Vector(-1496, -5812, -39), Vector(-1536, -5522, -17), Vector(-1552, -5283, -10), Vector(-1269, -5880, -41), Vector(-1269, -5880, -41), Vector(-1835, -5760, -73), Vector(-5009, -6285, -194), Vector(-4611, -6395, -210), Vector(-4611, -6395, -210), Vector(-4524, -6363, -214), Vector(-4733, -5789, -244), Vector(-4733, -5789, -244), Vector(-4761, -5523, -222), Vector(-6433, -4213, -254), Vector(-6380, -3772, -220), Vector(-5962, -3703, -226), Vector(-5529, -3725, -289), Vector(-5876, -3324, -213), Vector(-8053, -5930, -298), Vector(-7837, -5490, -293), Vector(-8154, -5088, -256), Vector(-7735, -5433, -295), Vector(-7720, -4939, -270), Vector(-7691, -4587, -272), Vector(-7869, -6495, -285), Vector(-7869, -6495, -285), Vector(-7814, -7218, -294), Vector(-7814, -7218, -294), Vector(-7551, -7942, -405), Vector(-3214, -11423, -380), Vector(-3552, -11938, -380), Vector(-3552, -11938, -380), Vector(-3440, -11886, -512), Vector(-3412, -11720, -512), Vector(-3442, -11468, -655), Vector(-3438, -11216, -649), Vector(-3171, -11073, -637), Vector(-3171, -11073, -637), Vector(-3532, -11160, -651), Vector(-4064, -11154, -637), Vector(-3789, -10843, -607), Vector(-4340, -10922, -607), Vector(-2595, -11616, -677), Vector(-2460, -11135, -665), Vector(-2286, -11203, -637), Vector(-2432, -12236, -712), Vector(-1692, -11249, -640), Vector(-1911, -12128, -646), Vector(-2103, -12432, -640), Vector(-1834, -12429, -640), Vector(-1834, -12429, -640), Vector(-1502, -12412, -640), Vector(-1131, -12335, -640), Vector(-842, -12394, -640), Vector(-912, -12607, -640), Vector(6715, -9892, -523), Vector(4936, -9963, -557), Vector(3651, -9900, -516), Vector(8690, -9255, -516), Vector(9297, -10080, -516), Vector(9854, -9910, -516), Vector(9100, -8794, -512), Vector(8890, -8694, -512), Vector(8890, -8694, -512), Vector(9539, -8639, -512), Vector(9539, -8639, -512), Vector(9781, -8376, -512), Vector(9781, -8376, -512), Vector(10047, -8456, -512), Vector(10403, -8504, -512), Vector(10236, -8971, -512), Vector(9907, -9045, -256), Vector(9134, -8776, -256), Vector(9555, -9835, -260), Vector(9613, -10959, -224), Vector(9584, -9659, 0), Vector(9582, -8981, 0), Vector(9150, -8413, 132), Vector(7805, -3870, -512), Vector(7653, -2786, -496), Vector(7653, -2786, -496), Vector(8290, -2879, -520), Vector(8497, -2740, -519), Vector(8829, -2957, -513), Vector(8829, -2957, -513), Vector(8937, -2578, -503), Vector(8937, -2578, -503), Vector(5449, 2912, -718), Vector(7522, 2484, -695), Vector(8598, 4104, -701)}

NpcZombie = "npc_fastzombie"
function ZombieLoad()
    SpawnZombies()
    timer.Create("SpawnTheZombies", 5, 0, function()
        SpawnZombies()
        despawnZombies()
    end)
end

local TotalZombies = 0
function SpawnZombies()
    for _, ent in pairs(ents.FindByClass(NpcZombie)) do TotalZombies = TotalZombies + 1 end
    local mapSpawnTable = ZombieSpawns[string.lower(game.GetMap())]
    for i = 1, table.Count(mapSpawnTable) do
        local dontSpawn = false
        local spawnVec = mapSpawnTable[i]
        for _, ent in pairs(ents.FindInSphere(spawnVec, 1000)) do
            if ent:IsPlayer() then
                dontSpawn = true
                break
            end
        end
        if (not dontSpawn) then
            for _, ent in pairs(ents.FindInSphere(spawnVec, 1000)) do
                if ent:GetClass() == NpcZombie then
                    dontSpawn = true
                    break
                end
            end
        end
        if (not dontSpawn and TotalZombies <= 25) then
            local newzombie = ents.Create(NpcZombie)
            newzombie:SetPos(spawnVec + Vector(0, 0, 30))
            newzombie:Spawn()
        end
    end
end
hook.Add("InitPostEntity", "ZombieLoad", ZombieLoad)

function despawnZombies()
    for _, ent in pairs(ents.FindByClass(NpcZombie)) do
        local Despawn = true
        for _, ply in pairs(player.GetAll()) do
            if ply:GetPos():Distance(ent:GetPos()) < 1500 then Despawn = false end
        end
        if Despawn == true then
            ent:Remove()
            TotalZombies = TotalZombies - 1
        end
    end
end